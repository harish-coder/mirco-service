package com.example.poc.employee.dao;

import java.util.List;

import javax.persistence.EntityManager;
import javax.persistence.PersistenceContext;
import javax.transaction.Transactional;

import org.hibernate.transform.AliasToBeanResultTransformer;
import org.springframework.stereotype.Repository;

import com.example.poc.employee.entity.EmployeeEntity;
import com.example.poc.employee.entity.JobsEnity;
import com.example.poc.employee.projection.EmployeeDto;

@Repository
@Transactional
public class EmployeeDao {

	@PersistenceContext
	private EntityManager entityManager;
	
	
	public List<EmployeeDto> getAllEmpDetails(){
		StringBuilder query = new StringBuilder();
		query.append("select new com.example.poc.employee.projection.emp.EmployeeDto(employeeId as employeeId,"
				+ "emp.firstName as firstName,"
				+ "emp.lastName as lastName,"
				+ "emp.email as email,"
				+ "emp.phoneNumber as phoneNumber,"
				+ "emp.hireDate as hireDate,"
				+ "job.jobTitle as jobTitle,"
				+ "job.minSalary as minSalary,"
				+ "job.maxSalary as maxSalary) "
				+ " from "+EmployeeEntity.class.getName()+" emp inner join "+JobsEnity.class.getName()+" job "
				+ " on emp.jobs = job.jobId ");
		List<EmployeeDto> empList=  entityManager.createQuery(query.toString(),EmployeeDto.class).getResultList();
		return (List<EmployeeDto>) empList;
	}
	
}
